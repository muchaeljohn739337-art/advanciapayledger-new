---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: api-gateway-netpol
  namespace: platform-core
  labels:
    app: api-gateway
    app.kubernetes.io/name: advancia
    app.kubernetes.io/component: api-gateway
spec:
  podSelector:
    matchLabels:
      app: api-gateway
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress-nginx
    - namespaceSelector:
        matchLabels:
          name: observability
    ports:
    - protocol: TCP
      port: 3000
    - protocol: TCP
      port: 9090
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: platform-core
    - namespaceSelector:
        matchLabels:
          name: services
    - namespaceSelector:
        matchLabels:
          name: database
    ports:
    - protocol: TCP
      port: 4001  # auth-service
    - protocol: TCP
      port: 4002  # monitoring-service
    - protocol: TCP
      port: 4003  # web3-service
    - protocol: TCP
      port: 4004  # ai-orchestrator
    - protocol: TCP
      port: 4005  # security-service
    - protocol: TCP
      port: 4006  # billing-service
    - protocol: TCP
      port: 4007  # notification-service
    - protocol: TCP
      port: 4008  # tenant-service
    - protocol: TCP
      port: 6379  # redis
    - protocol: TCP
      port: 5432  # postgres
  - to: []
    ports:
    - protocol: TCP
      port: 53    # DNS
    - protocol: UDP
      port: 53    # DNS
    - protocol: TCP
      port: 443   # HTTPS
    - protocol: TCP
      port: 80    # HTTP
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: auth-service-netpol
  namespace: platform-core
  labels:
    app: auth-service
    app.kubernetes.io/name: advancia
    app.kubernetes.io/component: auth-service
spec:
  podSelector:
    matchLabels:
      app: auth-service
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: api-gateway
    - namespaceSelector:
        matchLabels:
          name: observability
    ports:
    - protocol: TCP
      port: 4001
    - protocol: TCP
      port: 9090
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: database
    - namespaceSelector:
        matchLabels:
          name: cache
    ports:
    - protocol: TCP
      port: 5432  # postgres
    - protocol: TCP
      port: 6379  # redis
  - to: []
    ports:
    - protocol: TCP
      port: 53    # DNS
    - protocol: UDP
      port: 53    # DNS
    - protocol: TCP
      port: 443   # HTTPS
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: monitoring-service-netpol
  namespace: services
  labels:
    app: monitoring-service
    app.kubernetes.io/name: advancia
    app.kubernetes.io/component: monitoring-service
spec:
  podSelector:
    matchLabels:
      app: monitoring-service
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: api-gateway
    - namespaceSelector:
        matchLabels:
          name: observability
    ports:
    - protocol: TCP
      port: 4002
    - protocol: TCP
      port: 9090
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          name: database
    ports:
    - protocol: TCP
      port: 5432  # postgres
  - to: []
    ports:
    - protocol: TCP
      port: 53    # DNS
    - protocol: UDP
      port: 53    # DNS
    - protocol: TCP
      port: 443   # HTTPS
    - protocol: TCP
      port: 80    # HTTP
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ai-orchestrator-netpol
  namespace: services
  labels:
    app: ai-orchestrator
    app.kubernetes.io/name: advancia
    app.kubernetes.io/component: ai-orchestrator
spec:
  podSelector:
    matchLabels:
      app: ai-orchestrator
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: api-gateway
    - namespaceSelector:
        matchLabels:
          name: observability
    ports:
    - protocol: TCP
      port: 4004
    - protocol: TCP
      port: 9090
  egress:
  - to: []
    ports:
    - protocol: TCP
      port: 53    # DNS
    - protocol: UDP
      port: 53    # DNS
    - protocol: TCP
      port: 443   # HTTPS (AWS Bedrock)
    - protocol: TCP
      port: 80    # HTTP
